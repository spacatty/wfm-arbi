/**
 * Uses warframe-items to query all tradable mods and derive WFM-style url_name.
 * The canonical R10 list is generated by scripts/generate-r10-mod-list.mjs and
 * lives in src/data/tradable-r10-mod-url-names.ts (used by investment-scanner).
 *
 * Run: node scripts/query-tradable-mods.mjs
 */

import Items from "warframe-items";

/** WFM url_name: lowercase, spaces â†’ underscore, remove apostrophes */
function nameToUrlName(name) {
  if (!name || typeof name !== "string") return "";
  return name
    .toLowerCase()
    .replace(/\s+/g, "_")
    .replace(/'/g, "");
}

const items = new Items({ category: ["Mods"] });
const tradable = items.filter((m) => m.tradable === true);
const byUrlName = new Map();
for (const m of tradable) {
  const url = nameToUrlName(m.name);
  if (url && !byUrlName.has(url)) byUrlName.set(url, m.name);
}
const allTradableUrlNames = [...byUrlName.keys()].sort();

const primed = allTradableUrlNames.filter((u) => u.startsWith("primed_"));
const galvanized = allTradableUrlNames.filter((u) => u.startsWith("galvanized_"));
const archon = allTradableUrlNames.filter((u) => u.startsWith("archon_"));

console.log("--- Tradable mods (warframe-items) ---");
console.log("Total tradable mods:", allTradableUrlNames.length);
console.log("  Primed:", primed.length);
console.log("  Galvanized:", galvanized.length);
console.log("  Archon:", archon.length);

console.log("\n--- Primed (tradable) ---");
console.log(primed.join(", "));

console.log("\n--- Galvanized (tradable) ---");
console.log(galvanized.join(", "));

console.log("\n--- Archon (tradable) ---");
console.log(archon.join(", "));

// Validate against current DEFAULT_MOD_LIST in investment-scanner (keep in sync manually)
const DEFAULT_MOD_LIST = [
  "primed_flow", "primed_continuity", "primed_redirection", "primed_vitality",
  "primed_pressure_point", "primed_fever_strike", "primed_reach", "primed_heavy_trauma",
  "primed_smite_corpus", "primed_smite_grineer", "primed_smite_infested",
  "serration", "split_chamber", "heavy_caliber", "point_strike", "vital_sense",
  "vigilante_armaments", "hells_chamber", "primed_cryo_rounds", "primed_infected_clip",
  "primed_stormbringer", "primed_rifle_ammo_mutation", "primed_fast_hands",
  "high_voltage", "malignant_force", "thermite_rounds", "rime_rounds",
  "primed_point_blank", "primed_charged_shell", "primed_ravage", "primed_fulmination",
  "primed_shotgun_ammo_mutation", "blaze", "tactical_pump", "contagious_spread",
  "toxic_barrage", "frigid_blast", "shell_shock", "scattering_inferno",
  "hornet_strike", "barrel_diffusion", "lethal_torrent", "primed_pistol_gambit",
  "primed_target_cracker", "primed_heated_charge", "primed_convulsion", "primed_pathogen_rounds",
  "primed_slip_magazine", "primed_quickdraw", "primed_pistol_ammo_mutation",
  "jolt", "scorch", "frostbite", "pistol_pestilence", "convulsion", "pathogen_rounds",
  "heated_charge", "deep_freeze", "infected_clip", "stormbringer", "cryo_rounds",
  "pressure_point", "reach", "fury", "berserker", "organ_shatter", "true_steel",
  "spoiled_strike", "fever_strike", "north_wind", "shocking_touch", "molten_impact",
  "virulent_scourge", "volcanic_edge", "voltaic_strike", "vicious_frost",
  "primed_bane_of_corpus", "primed_bane_of_grineer", "primed_bane_of_infested",
  "collision_force", "sundering_strike", "shattering_impact",
  "vigilante_fervor", "vigilante_vengeance", "vigilante_supplies",
  "gladiator_might", "gladiator_vice", "gladiator_rush", "gladiator_resolve",
  "gladiator_aptitude", "gladiator_finesse",
  "hunter_munitions", "hunter_track", "hunter_adrenaline", "hunter_synergy",
  "hunter_recovery", "hunter_command", "hunter_instinct",
  "augur_message", "augur_reach", "augur_secrets", "augur_pact", "augur_accord",
  "stretch", "intensify", "streamline", "continuity", "flow", "vitality",
  "redirection", "steel_fiber", "animal_instinct", "fetch", "primed_animal_instinct",
  "primed_regen", "link_armor", "link_health", "link_shields", "maul", "bite",
  "savagery", "hunt", "pack_leader", "loyal_companion", "accelerated_blast",
  "ravage", "blunderbuss", "ammo_stock", "fatal_acceleration", "seeking_force",
  "tainted_shell", "chilling_reload", "critical_delay", "hammer_shot", "vile_acceleration",
  "metal_auger", "shred", "speed_trigger", "wildfire", "rifle_ammo_mutation",
  "fast_hands", "stunning_speed", "steady_hands", "target_cracker", "pistol_gambit",
  "gunslinger", "hollow_point", "creeping_bullseye", "anemic_agility", "pistol_ammo_mutation",
  "quickdraw", "slip_magazine", "lethal_momentum", "ice_storm", "trick_mag", "seeker",
  "stabilizer", "no_return", "razor_shot", "point_blank", "charged_shell", "flechette",
  "incendiary_coat", "chilling_grasp", "disruptor", "sawtooth_claw", "rending_turn",
  "dual_rounds", "eject_magazine",
  "archon_continuity", "archon_flow", "archon_intensify", "archon_stretch", "archon_vitality",
  "galvanized_chamber", "galvanized_aptitude", "galvanized_scope", "galvanized_hell",
  "galvanized_savvy", "galvanized_acceleration", "galvanized_diffusion", "galvanized_crosshairs",
  "galvanized_shot", "galvanized_steel", "galvanized_reflex", "galvanized_elementalist",
];
const validSet = new Set(allTradableUrlNames);
const invalid = DEFAULT_MOD_LIST.filter((u) => !validSet.has(u));
const valid = DEFAULT_MOD_LIST.filter((u) => validSet.has(u));

console.log("\n--- Validation vs DEFAULT_MOD_LIST (src/worker/investment-scanner.ts) ---");
console.log("In list:", DEFAULT_MOD_LIST.length, "| Valid (tradable in warframe-items):", valid.length, "| Not tradable:", invalid.length);
if (invalid.length > 0) {
  console.log("Not in warframe-items tradable set (may be named differently or missing in export):", invalid.join(", "));
}
